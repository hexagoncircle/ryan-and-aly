const thermostat=document.querySelector(".thermostat"),thermostatButton=document.getElementById("submit-temperature"),thermostatControl=document.querySelector(".thermostat-control"),thermostatFill=document.querySelector(".thermostat-fill"),thermostatKnob=document.querySelector(".thermostat-knob"),thermostatNumber=document.querySelector(".thermostat-number"),thermostatRelatedCount=document.querySelector(".thermostat-related-count"),thermostatRingRadius=thermostatFill.r.baseVal.value,thermostatRingCirc=2*thermostatRingRadius*Math.PI,temperatureText=document.querySelector(".thermostat-temp-text"),temperatureResults=document.getElementById("temperature-results"),temperatureResultsTemplate={primary:"",secondary:""},midTemp={min:93,max:100},skull=document.querySelector(".svg-skull");let currentGuess,currentAngle,skullActiveExpression=skull.dataset.expression,hasGuessed=!1;const handleThermostatUpdate=e=>{currentAngle=e,currentGuess=getTemperature(e),thermostatNumber.textContent=getTemperature(e),setSkullExpression(getTemperature(e)),setThermostatProgress(e/360*100)},handleThermostatButtonClick=()=>{thermostatButton.disabled=!0,thermostatButton.removeEventListener("click",handleThermostatUpdate),sendTemperatureGuess()},handleShowAllResultsClick=e=>{document.getElementById("show-all-results").removeEventListener("click",handleShowAllResultsClick),e.target.remove(),renderTemperatureSecondaryResults(temperatureResultsTemplate.secondary)},animateSkullExpression=()=>{const e=()=>{setTimeout(()=>skull.classList.remove("is-animating")),skull.removeEventListener("animationend",e,!1)};skull.classList.add("is-animating"),skull.addEventListener("animationend",e)},setSkullExpression=e=>{skull.dataset.expression=e<midTemp.min?1:e>midTemp.max?3:2,skullActiveExpression!==skull.dataset.expression&&(skullActiveExpression=skull.dataset.expression,animateSkullExpression())},setThermostatProgress=e=>{const t=thermostatRingCirc-e/100*thermostatRingCirc;thermostatFill.style.strokeDashoffset=t},getTemperature=e=>{return parseFloat(e/9+85).toFixed()},getTemperatureRelatedCount=e=>{const t=Object.entries(e).find(e=>currentGuess==e[0]),s=t?t[1]:1;thermostatRelatedCount.textContent=s>2?`${s-1} others guessed`:2===s?"1 other guessed":"You guessed it first!"},createTemperatureResult=({temperature:e,votes:t,total:s,index:r})=>0!==r?`\n      <li class="temperature-result">\n        <div class="value">${e}째</div>\n        <span class="votes">${t}</span>\n        <progress class="bar" value="${t}" max="${s/3}" />\n      </li>\n    `:`\n    <li class="temperature-result top-result">\n      <div class="value">\n        <span class="heading">${e}째</span> top guess\n      </div>\n      <span class="votes">${t} people</span>\n      <progress class="bar" value="${t}" max="${s/3.5}" />\n    </li>\n  `,renderTemperaturePrimaryResults=e=>{temperatureResults.insertAdjacentHTML("afterbegin",`\n      <p class="results-intro-copy">\n      ${checkSubmittedGuess(draggableKnob[0].rotation)} It reached a high of 94째 on July 17, 2021 at our place in Joshua Tree. However, at the time of our ceremony, it was a balmy 89째</p>\n      ${e}\n      <button id="show-all-results" class="button button--text">\n        Show all results\n      </button>\n    `),document.getElementById("show-all-results").addEventListener("click",e=>{handleShowAllResultsClick(e)}),temperatureResultsTimeline.resume().staggerFromTo(".temperature-result",1,{y:40,opacity:0},{y:0,opacity:1,duration:.2,ease:"power4.out"},.1,"-=0.8").fromTo("#show-all-results",{opacity:0},{opacity:1,duration:.5,ease:"power4.out"},"-=0.5")},renderTemperatureSecondaryResults=e=>{temperatureResults.insertAdjacentHTML("beforeend",`\n    <div class="secondary-results">\n      ${e}\n    </div>\n  `),temperatureResultsTimeline.resume().to(".secondary-results",{opacity:1,height:"auto",duration:.4,ease:"power4.out"})},setTemperatureResults=(e,t)=>{Object.entries(e).sort((e,t)=>t[1]-e[1]).map((e,s)=>{const r={temperature:e[0],votes:e[1],total:t,index:s};s<4?temperatureResultsTemplate.primary+=createTemperatureResult(r):temperatureResultsTemplate.secondary+=createTemperatureResult(r)}),renderTemperaturePrimaryResults(temperatureResultsTemplate.primary)};gsap.set(thermostatControl,{rotation:45});const draggableKnob=Draggable.create(thermostatControl,{trigger:thermostatKnob,type:"rotation",bounds:{minRotation:0,maxRotation:180},onDrag:function(){handleThermostatUpdate(this.rotation)}}),checkSubmittedGuess=e=>{const t=getTemperature(e);return 89==t?"You got it!":94==t?"":t<89?"Too low!":t>94?"Too hot!":t>89||t<94?"Close!":void 0},sendTemperatureGuess=()=>{draggableKnob[0].kill(),thermostatKnob.classList.add("is-disabled"),fetchTemperatureResults()},fetchTemperatureResults=()=>{fetch(resultsData).then(e=>e.json()).then(e=>{setTemperatureResults(e.QuestionResult,e.AnswersCount),getTemperatureRelatedCount(e.QuestionResult)}).catch(()=>thermostatButton.textContent="Can't submit at the moment")},temperatureResultsTimeline=gsap.timeline({paused:!0}).to(".thermostat-base-group",{opacity:0,scale:.96,duration:.5,ease:"power4.out"}).to(".temperature-results-list",{y:-125,height:"auto",marginBottom:-100,duration:.5,ease:"power4.out"},"<").to(".svg-skull",{x:"-140%",rotation:-30,duration:.25,ease:"power2.out"},"-=0.1").to(".svg-skull",{x:"-110%",rotation:0,duration:1,ease:"elastic.out(1.2, 0.4)"}).to(".thermostat-temp",{x:"25%",y:"-118%",scale:.8,duration:.5,ease:"power4.out"},"-=1.25").fromTo(".svg-hot-take",{opacity:0,x:"-50%",rotation:-30},{x:0,rotation:0,opacity:1,duration:.75,ease:"elastic.out(0.6, 0.3)"},"-=1").to(".thermostat-related-count",{opacity:1,duration:.5,ease:"power4.out"},"<").to(".temperature-results-list",{opacity:1,y:-150,duration:.6,ease:"power4.out"},"<");gsap.to(".svg-parallax",{yPercent:-10,ease:"none",scrollTrigger:{trigger:".js-parallax",start:"top",end:"+=100%",scrub:.5}});const initThermostat=()=>{handleThermostatUpdate(gsap.getProperty(thermostatControl,"rotation"))};thermostatButton.addEventListener("click",handleThermostatButtonClick),handleThermostatUpdate(gsap.getProperty(thermostatControl,"rotation"));